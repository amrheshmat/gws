@using TripBusiness.Ibusiness
@inject ILocalizationService _localizationService;
@model BlogsModel;
@{
    Layout = "~/Views/Shared/_layout.cshtml";
    var recentLogs = ViewBag.recentLogs;
    var recentAttachments = ViewBag.recentAttachments;
    int totalPages = Model.totalPages.Value;
    int currentPage = Convert.ToInt32(Context.Request.Query["page"]);
    if (currentPage < 1) currentPage = 1;
    if (currentPage > totalPages) currentPage = totalPages;
    List<int?> pagesToShow = new List<int?>();

    // Always show first two pages
    pagesToShow.Add(1);
    if (totalPages >= 2) pagesToShow.Add(2);

    // Ellipsis before middle if needed
    if (currentPage > 4)
        pagesToShow.Add(null);
    // Middle (currentPage - 1, currentPage, currentPage + 1)
    if (currentPage > 2 && currentPage < totalPages - 1)
    {
        pagesToShow.Add(currentPage - 1);
        pagesToShow.Add(currentPage);
        pagesToShow.Add(currentPage + 1);
    }
    // Ellipsis after middle if needed
    if (currentPage <= totalPages - 3)
        pagesToShow.Add(null);
    // Last 2 pages
    if (totalPages > 2)
    {
        pagesToShow.Add(totalPages - 1);
        pagesToShow.Add(totalPages);
    }
}
<section class="ftco-section ftco-no-pb">
    <div class="container" style="margin-top:130px;">
        <div class="row">
            <div class="col-lg-8 col-md-7">
                <div class="row d-flex" id="blogsShow">
                    @foreach (var blog in Model.blogs)
                    {
                        @if (blog.BlogImage != null)
                        {
                            var words = blog.description?.Split(' ', StringSplitOptions.RemoveEmptyEntries);
                            var preview = words != null && words.Length > 20
                            ? string.Join(" ", words.Take(20)) + "..."
                            : blog.description;
                            <div class="col-md-6">
                                <div class="card blog-card">
                                    <img src="Files/@blog.BlogImage" class="card-img-top" alt="Blog Post 1" loading="lazy" />
                                    <div class="card-body">
                                        <h5 class="card-title">@blog.title</h5>
                                        <p class="card-text">@preview</p>
                                        <a href="/BlogSingle/@blog.blogId" class="stretched-link">Read More</a>
                                    </div>
                                </div>
                            </div>
                        }
                    }
                </div>
                <div class="row mt-5" style="margin:60px!important;">
                    <div class="col">
                        <div class="block-27">
                            <ul id="pagination">
                                @if (Model.totalCount > 1)
                                {
                                    @if (currentPage > 1)
                                    {

                                        <li class=""><a href="?page=@(currentPage - 1)"><i class="fa fa-backward"></i></a></li>
                                    }
                                    else
                                    {
                                        <li class="disabled"><span class=""><i class="fa fa-backward"></i></span></li>
                                    }
                                    @foreach (var i in pagesToShow.Distinct())
                                    {
                                        if (i == null)
                                        {
                                            <li><span>...</span></li>
                                        }
                                        else
                                        {
                                            <li class="@(currentPage == i ? "active" : "")"
                                                id="pageId-@i"><a href="/blogs?page=@i">@i</a></li>
                                        }
                                    }
                                    @if (currentPage < totalPages)
                                    {
                                        <li class=""><a href="?page=@(currentPage + 1)"><i class="fa fa-forward"></i></a></li>
                                    }
                                    else
                                    {
                                        <li class="disabled"><span class=""><i class="fa fa-forward"></i></span></li>
                                    }
                                }


                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-4 col-md-5 sidebar ftco-animate pl-md-5 mt-5 mt-md-0 pt-md-0 pt-5 fadeInUp ftco-animated">
                <div class="sidebar-box ftco-animate fadeInUp ftco-animated">
                    <h3>@_localizationService.Localize("RecentBlog")</h3>
                    @foreach (var b in recentLogs)
                    {
                        foreach (var image in recentAttachments)
                        {
                            if (b.blogId == image.elementId)
                            {
                                <div class="block-21 mb-4 d-flex justify-content-between" style="position:relative;margin-left: 75px;">
                                    <a class="blog-img" style="width: 90px; height: 60px; ">
                                        <img src="/Files/@image.attachmentPath" style="background-size: contain; background-repeat: no-repeat;width:100%;height:100%" />
                                    </a>
                                    <div class="text pl-3" style="position: absolute; left: 100px;text-align: left;">
                                        <h3 class="heading" style="font-size: 20px; font-family: serif;"><a href="/BlogSingle/@b.blogId">@b.title</a></h3>
                                        <div class="meta">
                                            <div><a href="#"><span class="fa fa-calendar"></span>@b.creationDate</a></div>
                                        </div>
                                    </div>
                                </div>
                                break;
                            }
                        }
                    }
                </div>
            </div>
        </div>
    </div>
</section>
<script>
    $(document).ready(function () {
      
    });
</script>