@using TripBusiness.Ibusiness
@model ServiceProvidersModel;
@inject ILocalizationService _localizationService;
@{
    Layout = "~/Views/Shared/_layout.cshtml";
    var cities = ViewBag.cities;
    var categories = ViewBag.categories;
    int totalPages = Model.totalPages.Value;
    int currentPage = Convert.ToInt32(Context.Request.Query["page"]);
    if (currentPage < 1) currentPage = 1;
    if (currentPage > totalPages) currentPage = totalPages;
    List<int?> pagesToShow = new List<int?>();

    // Always show first two pages
    pagesToShow.Add(1);
    if (totalPages >= 2) pagesToShow.Add(2);

    // Ellipsis before middle if needed
    if (currentPage > 4)
        pagesToShow.Add(null);
    // Middle (currentPage - 1, currentPage, currentPage + 1)
    if (currentPage > 2 && currentPage < totalPages - 1)
    {
        pagesToShow.Add(currentPage - 1);
        pagesToShow.Add(currentPage);
        pagesToShow.Add(currentPage + 1);
    }
    // Ellipsis after middle if needed
    if (currentPage <= totalPages - 3)
        pagesToShow.Add(null);
    // Last 2 pages
    if (totalPages > 2)
    {
        pagesToShow.Add(totalPages - 1);
        pagesToShow.Add(totalPages);
    }
}
<style>
    body {
        background-color: #f8f9fa;
    }
     .card {
      transition: 0.3s;
    }
    .card:hover {
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    p{
        padding:0px;
        color:#000;
    }
    .filters {
      background: white;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 20px;
    }
    .filters div{
        text-align:left;
    }
    @@media (max-width: 768px) {
      .filters {
        margin-bottom: 10px;
      }
    }

    #pagination li.active {
        background-color: #007bff;
        color: white;
        font-weight: bold;
    }
</style>
<div class="container py-4" style="margin-top:100px;">
    <div class="row">
        <!-- Sidebar Filters -->
        <div class="col-lg-3">
            <div class="filters">
                <h5>Filters</h5>
                <div class="mb-3">
                    <label for="categoryFilter" class="form-label">Category</label>
                    <select asp-for="searchModel.category"
                            style="appearance: auto;" class="form-control">
                        <option value="" selected>Select Category</option>
                        @foreach (var category in categories)
                        {
                            <option value="@category.id">@category.name</option>
                        }
                    </select>
                </div>
                <div class="mb-3">
                    <label for="locationFilter" class="form-label">Location</label>
                    <select asp-for="searchModel.city"
                            style="appearance: auto;" class="form-control">
                        <option value="" selected>Select City</option>
                        @foreach (var city in cities)
                        {
                            <option value="@city.id">@city.name</option>
                        }
                    </select>
                </div>
                <div class="mb-3">
                    <label for="locationFilter" class="form-label">Gender</label>
                    <select asp-for="searchModel.city"
                            style="appearance: auto;" class="form-control">
                        <option value="" selected>Select Gender</option>
                        <option value="m">Male</option>
                        <option value="f">Female</option>
                    </select>
                </div>
               @*  <div class="mb-3">
                    <label for="ratingFilter" class="form-label">Rating</label>
                    <select class="form-select" id="ratingFilter">
                        <option value="">Any</option>
                        <option value="4">4★ & above</option>
                        <option value="3">3★ & above</option>
                    </select>
                </div> *@
                <div class="mb-3">
                    <label for="priceFilter" class="form-label">Price Range</label>
                    <select class="form-select" id="priceFilter">
                        <option value="">All</option>
                        <option value="low">Low to High</option>
                        <option value="high">High to Low</option>
                    </select>
                </div>
                <button class="btn btn-primary w-100" id="applyFilters">Apply Filters</button>
            </div>
        </div>

        <!-- Search Results -->
        <div class="col-lg-9">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h5 class="mb-0">All Providers</h5>
                <div>
                    <select class="form-select" id="sortResults" style="width: 200px;">
                        <option selected>Sort by</option>
                        <option value="name">Name</option>
                        <option value="category">Category</option>
                        <option value="city">City</option>
                        <option value="price">Price</option>
                    </select>
                </div>
            </div>

            <div class="row" id="resultsContainer">
                <!-- Example Result Card -->
                @foreach (var subscriber in Model.subscribers)
                {
                    <div class="col-md-6 col-xl-4 mb-4 result-item" data-rating="4" data-price="high" data-category="photography">
                        <div class="card" style="padding:0px;">
                            <div style="width:100%;height:200px;">
                                @if(subscriber.ProfileImage != null){
                                    <img src="/Files/@subscriber.ProfileImage" style="border-radius: 10px 10px 0px 0px;background-repeat: no-repeat; background-size: contain;width:100%;height:100%" />
                                }
                                else{
                                    <img src="/images/default-profile-image.jpg" style="border-radius: 10px 10px 0px 0px;background-repeat: no-repeat; background-size: contain;width:100%;height:100%" />
                                    }
                                </div>
                            <div class="card-body" style="padding: 20px 10px;">
                                <h6 class="card-title">
                                    <i class="fa fa-user" style="margin: 0px 5px; color: #2b57a4;"></i>@subscriber.Name
                                    <i class="fa fa-location-dot" style="margin: 0px 5px; color: #2b57a4;"></i>@subscriber.City
                                </h6>
                                @* <p class="card-text">Cairo, Egypt</p> *@
                                @* <p class="text-warning mb-1">★★★★☆</p> *@
                                <!-- Packages -->
                                <div class="mt-2">
                                    <p class="list-inline small mb-2" style="text-align: center;">
                                        @foreach(var package in subscriber.Packages)
                                        {
                                            <span class="list-inline-item"><span style="font-weight:bold">@package.title:</span> <span style="color:#2b57a4">@package.price$</span></span>
                                        }
                                    </p>
                                </div>
                                <div style="margin-top: 10px;padding: 15px;">
                                    <a href="#" style="padding:10px 5px;margin: 5px;display:inline;" class="btn btn-outline-primary w-100">
                                        <i class="fa fa-user" style="margin: 0px 5px; color: #fff;"></i>
                                        View Profile
                                    </a>
                                    <a href="tel:@subscriber.Phone" style="padding:10px 5px;margin: 5px;display:inline;" class="btn btn-outline-primary w-100">
                                        <i class="fa fa-phone" style="margin: 0px 5px; color: #fff;"></i>
                                        phone call
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                }
            </div>
            <div class="row mt-5" style="margin:60px!important;">
                <div class="col">
                    <div class="block-27">
                        <ul id="pagination">
                            @if (Model.totalCount > 1)
                            {
                                @if (currentPage > 1)
                                {

                                    <li class=""><a href="?page=@(currentPage - 1)"><i class="fa fa-backward"></i></a></li>
                                }
                                else
                                {
                                    <li class="disabled"><span class=""><i class="fa fa-backward"></i></span></li>
                                }
                                @foreach (var i in pagesToShow.Distinct())
                                {
                                    if (i == null)
                                    {
                                        <li><span>...</span></li>
                                    }
                                    else
                                    {
                                    <li class="@(currentPage == i ? "active" : "")"
                                        id="pageId-@i"><a href="?page=@i">@i</a></li>
                                    }
                                }
                                @if (currentPage < totalPages)
                                {
                                    <li class=""><a href="?page=@(currentPage + 1)"><i class="fa fa-forward"></i></a></li>
                                }
                                else
                                {
                                    <li class="disabled"><span class=""><i class="fa fa-forward"></i></span></li>
                                }
                            }

                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(document).ready(function () {
        $('#applyFilters').click(function () {
            let category = $('#categoryFilter').val().toLowerCase();
            let rating = $('#ratingFilter').val();
            let price = $('#priceFilter').val();

            $('.result-item').hide().filter(function () {
                let item = $(this);
                let itemCat = item.data('category');
                let itemRating = parseInt(item.data('rating'));
                let itemPrice = item.data('price');

                return (!category || category === itemCat)
                    && (!rating || itemRating >= rating)
                    && (!price || price === itemPrice);
            }).show();
        });

        $('#sortResults').change(function () {
            let sortBy = $(this).val();
            let items = $('.result-item').get();

            items.sort(function (a, b) {
                if (sortBy === 'name') {
                    return $(a).find('.card-title').text().localeCompare($(b).find('.card-title').text());
                }
                if (sortBy === 'rating') {
                    return $(b).data('rating') - $(a).data('rating');
                }
                if (sortBy === 'price') {
                    let priceVal = { low: 1, high: 2 };
                    return priceVal[$(a).data('price')] - priceVal[$(b).data('price')];
                }
            });

            $('#resultsContainer').append(items);
        });
    });
</script>