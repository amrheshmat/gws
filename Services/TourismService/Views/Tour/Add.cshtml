@using TripBusiness.Ibusiness
@model MWS.Data.Entities.Tour;
@inject ILocalizationService _localizationService;
@{
    ViewData["Title"] = "Admin Page";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
    var days = ViewBag.days;
    var languages = ViewBag.languages;
    var activities = ViewBag.activities;
}
    
<!-- Modal -->
@using (Html.BeginForm("Add", "Tour", FormMethod.Post, new { enctype = "multipart/form-data" }))
{
    @Html.TextBoxFor(m => m.tourId, new { @id = "tourId", @class = "form-control", style = "display:none" })
    <div class="container" style="margin-top:100px;width:85%;">
    <div class="row">
            <div class="col-xs-12 col-md-4" style="margin:20px 0px;">
        <label class="form-label" for="title">
                    @_localizationService.Localize("title")
        </label>
        @Html.TextBoxFor(m => m.title, new { @id = "title", @class = "form-control"})
        <span id="titleRequired" style="color:red"></span>
    </div>
    <div class="col-xs-12 col-md-4" style="margin:20px 0px;">
        <label class="form-label" for="duration">
                    @_localizationService.Localize("Duration")
        </label>
        @Html.TextBoxFor(m => m.duration, new { type = "number", @id = "duration", @class = "form-control" })
                <span id="durationRequired" style="color:red"></span>
    </div>
    <div class="col-xs-12 col-md-4" style="margin:20px 0px;">
        <label class="form-label" for="tourType">
            @_localizationService.Localize("TourType")
        </label>
        @Html.TextBoxFor(m => m.tourType, new { @id = "tourType", @class = "form-control" })
        <span id="tourTypeRequired" style="color:red"></span>
    </div>
    <div class="col-xs-12 col-md-4" style="margin:20px 0px;">
        <label class="form-label" for="tourLocation">
                    @_localizationService.Localize("TourLocation")
        </label>
                @Html.TextAreaFor(m => m.tourLocation, new { @id = "tourLocation", @class = "form-control" })
        <span id="tourLocationRequired" style="color:red"></span>
    </div>
    <div class="col-xs-12 col-md-4" style="margin:20px 0px;">
        <label class="form-label" for="pickupLocation">
                    @_localizationService.Localize("PickupLocation")
        </label>
                @Html.TextAreaFor(m => m.pickupLocation, new { @id = "pickupLocation", @class = "form-control" })
                <span id="pickupLocationRequired" style="color:red"></span>
            </div>
    <div class="col-xs-12 col-md-4" style="margin:20px 0px;">
        <label class="form-label" for="dropOff">
                    @_localizationService.Localize("DropOff")
        </label>
                @Html.TextAreaFor(m => m.dropOff, new { @id = "dropOff", @class = "form-control"})
                <span id="dropOffRequired" style="color:red"></span>
            </div>
            <div class="col-xs-12 col-md-4" style="margin:20px 0px;">
                <label class="form-label" for="adultPrice">
                    @_localizationService.Localize("adultPrice")
                </label>
                @Html.TextBoxFor(m => m.adultPrice, new { type = "number", @id = "adultPrice", @class = "form-control" })
                <span id="adultPriceRequired" style="color:red"></span>
            </div>
            <div class="col-xs-12 col-md-4" style="margin:20px 0px;">
                <label class="form-label" for="adultPriceForDouble">
                    @_localizationService.Localize("adultPriceForDouble")
                </label>
                @Html.TextBoxFor(m => m.adultPriceForDouble, new { type = "number", @id = "adultPriceForDouble", @class = "form-control" })
                <span id="adultPriceForDoubleRequired" style="color:red"></span>
            </div>
            <div class="col-xs-12 col-md-4" style="margin:20px 0px;">
                <label class="form-label" for="adultPriceForSuite">
                    @_localizationService.Localize("adultPriceForSuite")
                </label>
                @Html.TextBoxFor(m => m.adultPriceForSuite, new { type = "number", @id = "adultPriceForSuite", @class = "form-control" })
                <span id="adultPriceForSuiteRequired" style="color:red"></span>
            </div>
            <div class="col-xs-12 col-md-4" style="margin:20px 0px;">
                <label class="form-label" for="childPrice">
                    @_localizationService.Localize("childPrice")
                </label>
                @Html.TextBoxFor(m => m.childPrice, new { type = "number", @id = "childPrice", @class = "form-control" })
                <span id="childPriceRequired" style="color:red"></span>
            </div>
            <div class="col-xs-12 col-md-4" style="margin:20px 0px;">
                <label class="form-label" for="infantPrice">
                    @_localizationService.Localize("infantPrice")
                </label>
                @Html.TextBoxFor(m => m.infantPrice, new { type = "number", @id = "infantPrice", @class = "form-control" })
                <span id="infantPriceRequired" style="color:red"></span>
            </div>
    <div class="col-xs-12 col-md-4" style="margin:20px 0px;">
        <label class="form-label" for="capacity">
                    @_localizationService.Localize("Capacity")
        </label>
                @Html.TextBoxFor(m => m.capacity, new { type = "number", @id = "capacity", @class = "form-control" })
                <span id="capacityRequired" style="color:red"></span>
    </div>
            <div class="col-xs-12 col-md-4" style="margin:20px 0px;">
                <label class="form-label" for="capacity" style="display:block">
                    @_localizationService.Localize("AvaliableDays")
                </label>
                <select class="form-control" name="field2" id="field2" multiple multiselect-search="true" multiselect-select-all="true" multiselect-max-items="2" onchange="test(this.selectedOptions)">
                    @foreach (var day in days)
                    {
                        <option value="@day.dayId" id="@day.dayId">@day.dayName</option>
                    }
                </select>
                <span id="dayRequired" style="color:red"></span>

             </div>
            <div class="col-xs-12 col-md-4" style="margin:20px 0px;">
                <label class="form-label" for="capacity" style="display:block">
                    @_localizationService.Localize("BlockedDates")
                </label>
                <div class="form-group">
                    <div>
                        <i class="fa fa-calendar-alt" onclick="showDatePicker()" id="showDatePicker"></i>
                    </div>
                    <input class="date-pick form-control required valid" disabled="disabled"
                           type="text" name="dateBooking" id="datepicker">
                </div>
                <div id="addBlockDates">
                    <div style='position: relative; '> <i onclick='remove(event)' class='fa fa-trash' style='position: absolute; right: -15px; top: 15px; '></i><input type="text"  id="BlockDates" class="form-control"></div>
                </div>
            </div>
            <div class="col-xs-12 col-md-4" style="margin:20px 0px;">
                <label class="form-label" for="capacity" style="display:block">
                    @_localizationService.Localize("AvaliableLanguages")
                </label>
                <select class="form-control" name="field3" id="field3" multiple multiselect-search="true" multiselect-select-all="true" multiselect-max-items="2" onchange="test(this.selectedOptions)">
                    @foreach (var language in languages)
                    {
                        <option value="@language.languageId" id="@language.languageId">@language.languageName</option>
                    }
                </select>
                <span id="availablelanguageRequired" style="color:red"></span>

            </div>
            <div class="col-xs-12 col-md-4" style="margin:20px 0px;" id="languageDiv">
                <label class="form-label" for="language">
                    @_localizationService.Localize("language")
                </label>
                @Html.TextBoxFor(m => m.languageId, new { @id = "languageId", @class = "form-control", style = "display:none" })
                <select name="language" class="form-select" id="language">
                    @foreach (var language in languages)
                    {
                        <option value="@language.languageId">@language.languageName</option>
                    }
                </select>
                <span id="languageRequired" style="color:red"></span>
            </div>
            <div class="col-xs-12 col-md-4" style="margin:20px 0px;">
                <label class="form-label" for="capacity" style="display:block">
                    @_localizationService.Localize("additionalActivity")
                </label>
                <select class="form-control" name="field4" id="field4" multiple multiselect-search="true" multiselect-select-all="true" multiselect-max-items="2" onchange="test(this.selectedOptions)">
                    @foreach (var activity in activities)
                    {
                        <option value="@activity.additionalActivityId" id="@activity.additionalActivityId">@activity.title</option>
                    }
                </select>
            </div>
          @*   <div class="col-xs-12 col-md-4" style="margin:20px 0px;">
                <label class="form-label" for="overview">
                    @_localizationService.Localize("Overview")
                </label>
                @Html.TextAreaFor(m => m.overview, new { @id = "overview", @class = "form-control" })
                <span id="overviewRequired" style="color:red"></span>
            </div> *@
            <div class="col-xs-12 col-md-4" style="margin:20px 0px;">
                <label class="form-label" for="highlights">
                    @_localizationService.Localize("Highlights")
                </label>
                @Html.TextAreaFor(m => m.highlights, new { @id = "highlights", @class = "form-control" })
                <span id="highlightsRequired" style="color:red"></span>
            </div>
            <div  class="col-xs-12 col-md-4" style="margin:20px 0px;">
                <label class="form-label" for="include" style="width:80%">
                    @_localizationService.Localize("Includes")
                </label>
                <i class="fa fa-plus" id="addIncludeBtn" style="cursor: pointer; background: #624bff; padding: 5px; color: #fff; border-radius: 50%;"></i>
                <div id="addInclude">
                <textarea type="text" id="include" class="form-control"></textarea>
                </div>
                <span id="includeRequired" style="color:red"></span>
            </div>
            <div class="col-xs-12 col-md-4" style="margin:20px 0px;">
                <label class="form-label" for="exclude" style="width:80%">
                    @_localizationService.Localize("Excludes")
                </label>
                <i class="fa fa-plus" id="addExcludeBtn" style="cursor: pointer; background: #624bff; padding: 5px; color: #fff; border-radius: 50%;"></i>
                <div id="addExclude">
                    <textarea type="text" id="exclude" class="form-control" cursor: pointer; background: #624bff; padding: 5px; color: #fff; border-radius: 50%;></textarea>
                </div>
                <span id="excludeRequired" style="color:red"></span>

            </div>
            <div  class="col-xs-12 col-md-4" style="margin:20px 0px;">
                <label class="form-label" for="Expect" style="width:80%">
                    @_localizationService.Localize("Expects")
                </label>
                <i class="fa fa-plus" id="addExpectBtn" style="cursor: pointer; background: #624bff; padding: 5px; color: #fff; border-radius: 50%;"></i>
                <div id="addExpect">
                    <textarea type="text" id="1" class="form-control expect" style="cursor:pointer;"></textarea>
                </div>
                <span id="expectRequired" style="color:red"></span>
            </div>
          @*   <div class="col-xs-12 col-md-4" style="margin:20px 0px;">
                <label class="form-label" for="packup" style="width:80%">
                    @_localizationService.Localize("Packups")
                </label>
                <i class="fa fa-plus" id="addPackBtn" style="cursor: pointer; background: #624bff; padding: 5px; color: #fff; border-radius: 50%;"></i>
                <div id="addPack">
                    <textarea type="text" id="pack" class="form-control" style="cursor:pointer;"></textarea>
                </div>
                <span id="packRequired" style="color:red"></span>
            </div> *@
            <div class="col-xs-12 col-md-4" style="margin:20px 0px;">
                <label class="form-label" for="additionalInformation" style="width:80%">
                    @_localizationService.Localize("AdditionalInformation")
                </label>
                <i class="fa fa-plus" id="addadditionalInformationBtn" style="cursor: pointer; background: #624bff; padding: 5px; color: #fff; border-radius: 50%;"></i>
                <div id="addadditionalInformation">
                    <textarea type="text" id="additionalInformation" class="form-control" style="cursor:pointer;"></textarea>
                </div>
                <span id="additionalInformationRequired" style="color:red"></span>
            </div>
           
            <div>
                <button type="submit" class="btn btn-primary" id="addTourBtn">@_localizationService.Localize("Save")</button>
            </div>
        </div>
    </div>
   
}


<script>
    function test(selectedOptions) {
        var val = "";
        for (var i = 0; i < selectedOptions.length; i++) {
            val += selectedOptions[i].id + ",";
        }
    }
    function showDatePicker() {
        $("#datepicker").datepicker('show'); //Show on click of button

        //$(".ui-datepicker-next").append("<i class='fa fa-chevron-right'></i>");
    }
    $(document).ready(function () {
        var dateToday = new Date();
        var dayCount = $("#addExpect textarea:last").attr("id");
        $("#datepicker").datepicker({
            dateFormat: "DD, dd-mm- yy",
            minDate: dateToday
        }).on("change", function () {
            datetime = $("#datepicker").datepicker("getDate");
            //datetime = datetime.substring(0, datetime.indexOf("T"));
            var year = $("#datepicker").datepicker("getDate").getFullYear();
            var month = $("#datepicker").datepicker("getDate").getMonth() + 1;
            var day = $("#datepicker").datepicker("getDate").getDate();
            debugger;
            if (parseInt(day) < 10)
                day = "0" + day;
            if (parseInt(month) < 10)
                month = "0" + month;
            datetime = day + "-" + month + "-" + year;
            $("#addBlockDates").append("<div style='position: relative; '> <i onclick='remove(event)' class='fa fa-trash' style='position: absolute; right: -15px; top: 15px; '></i>  <input type='text' value='" + datetime + "'  class='form-control' style='margin:5px 0px'></div>");

        });
        $(document).on('change', '#language', function () {
            $("#languageId").val($(this).val());
        });
        $('#addTourBtn').on("click", function (e) {
            e.preventDefault();
            //validation
            if ($("#title").val() == '') {
                $("#titleRequired").text("required");
                return false;
            } else {
                $("#titleRequired").text("");
            }
            if ($("#duration").val() == '') {
                $("#durationRequired").text("required");
                return false;
            } else {
                $("#durationRequired").text("");
            }
            if ($("#tourLocation").val() == '') {
                $("#tourLocationRequired").text("required");
                return false;
            } else {
                $("#tourLocationRequired").text("");
            }
            if ($("#pickupLocation").val() == '') {
                $("#pickupLocationRequired").text("required");
                return false;
            } else {
                $("#pickupLocationRequired").text("");
            }
            if ($("#dropOff").val() == '') {
                $("#dropOffRequired").text("required");
                return false;
            } else {
                $("#dropOffRequired").text("");
            }
            if ($("#tourType").val() == '') {
                $("#tourTypeRequired").text("required");
                return false;
            } else {
                $("#tourTypeRequired").text("");
            }
            if ($("#language").val() == '') {
                $("#languageRequired").text("required");
                return false;
            } else {
                $("#languageRequired").text("");
            }
            // if ($("#overview").val() == '') {
            //     $("#overviewRequired").text("required");
            //     return false;
            // } else {
            //     $("#overviewRequired").text("");
            // }
            if ($("#highlights").val() == '') {
                $("#highlightsRequired").text("required");
                return false;
            } else {
                $("#highlightsRequired").text("");
            }
            if ($("#adultPrice").val() == '') {
                $("#adultPriceRequired").text("required");
                return false;
            } else {
                $("#adultPriceRequired").text("");
            }
            if ($("#adultPriceForDouble").val() == '') {
                $("#adultPriceForDoubleRequired").text("required");
                return false;
            } else {
                $("#adultPriceForDoubleRequired").text("");
            }
            if ($("#adultPriceForSuite").val() == '') {
                $("#adultPriceForSuiteRequired").text("required");
                return false;
            } else {
                $("#adultPriceForSuiteRequired").text("");
            }
            if ($("#childPrice").val() == '') {
                $("#childPriceRequired").text("required");
                return false;
            } else {
                $("#childPriceRequired").text("");
            }
            if ($("#infantPrice").val() == '') {
                $("#infantPriceRequired").text("required");
                return false;
            } else {
                $("#infantPriceRequired").text("");
            }
            if ($("#capacity").val() == '') {
                $("#capacityRequired").text("required");
                return false;
            } else {
                $("#capacityRequired").text("");
            }
            if ($("#field2").val() == '') {
                $("#dayRequired").text("required");
                return false;
            } else {
                $("#dayRequired").text("");
            }
            if ($("#field3").val() == '') {
                $("#availablelanguageRequired").text("required");
                return false;
            } else {
                $("#availablelanguageRequired").text("");
            }
            if ($("#include").val() == '') {
                $("#includeRequired").text("required");
                return false;
            } else {
                $("#includeRequired").text("");
            }
            if ($("#exclude").val() == '') {
                $("#excludeRequired").text("required");
                return false;
            } else {
                $("#excludeRequired").text("");
            }
             if ($(".expect").val() == '') {
                $("#expectRequired").text("required");
                return false;
            } else {
                $("#expectRequired").text("");
            }
            // if ($("#pack").val() == '') {
            //     $("#packRequired").text("required");
            //     return false;
            // } else {
            //     $("#packRequired").text("");
            // }
            if ($("#additionalInformation").val() == '') {
                $("#additionalInformationRequired").text("required");
                return false;
            } else {
                $("#additionalInformationRequired").text("");
            }
            var includes = [];
            var excludes = [];
            // var packs = [];
            var additionalInformations = [];
            var expects = [];
            var blockDates = [];
            $('#addBlockDates div').children('input').each(function () {
                var d = {
                    "date": this.value,
                };
                blockDates.push(d);
            });
            $('#addInclude').children('textarea').each(function () {
                var include = {
                    "includeText": this.value,
                };
                includes.push(include);
            });
            $('#addInclude div').children('textarea').each(function () {
                var include = {
                    "includeText": this.value,
                };
                includes.push(include);
            });
            $('#addExclude').children('textarea').each(function () {
                var exclude = {
                    "excludeText": this.value,
                };
                excludes.push(exclude);
            });
            $('#addExclude div').children('textarea').each(function () {
                var exclude = {
                    "excludeText": this.value,
                };
                excludes.push(exclude);
            });
            $('#addExpect').children('textarea').each(function () {
                var expect = {
                    "details": this.value,
                    "order": this.id
                };
                expects.push(expect);
            });
            $('#addExpect div').children('textarea').each(function () {
                var expect = {
                    "details": this.value,
                    "order": this.id
                };
                expects.push(expect);
            });
            // $('#addPack').children('textarea').each(function () {
            //      debugger;
            //     var pack = {
            //         "title": this.value,
            //     };
            //     packs.push(pack);
            // });
            // $('#addPack div').children('textarea').each(function () {
            //     debugger;
            //     var pack = {
            //         "title": this.value,
            //     };
            //     packs.push(pack);
            // });
            $('#addadditionalInformation').children('textarea').each(function () {
                debugger;
                var additionalInformation = {
                    "details": this.value,
                };
                additionalInformations.push(additionalInformation);
            });
            $('#addadditionalInformation div').children('textarea').each(function () {
                debugger;
                var additionalInformation = {
                    "details": this.value,
                };
                additionalInformations.push(additionalInformation);
            });
            var selectedDays = [];
          
            for (var i = 0; i < $("#field2").val().length; i++) {
                var day = {
                    "dayId": $("#field2").val()[i],
                };
                selectedDays.push(day);
            }
            var selectedLanguages = [];
            for (var i = 0; i < $("#field3").val().length; i++) {
                var Language = {
                    "LanguageId": $("#field3").val()[i],
                };
                selectedLanguages.push(Language);
            }

            var selectedActivities = [];
            for (var i = 0; i < $("#field4").val().length; i++) {
                var activity = {
                    "additionalActivityId": $("#field4").val()[i],
                };
                selectedActivities.push(activity);
            }

            var tour = {};
            tour.tour = {};
            tour.tour.title = $("#title").val();
            tour.tour.duration = $("#duration").val();
            tour.tour.tourLocation = $("#tourLocation").val();
            tour.tour.pickupLocation = $("#pickupLocation").val();
            tour.tour.dropOff = $("#dropOff").val();
            tour.tour.tourType = $("#tourType").val();
            tour.tour.highlights = $("#highlights").val();
            // tour.tour.overview = $("#overview").val();
            tour.tour.languageId = $("#language").val();
            tour.tour.capacity = $("#capacity").val();
            tour.tour.adultPrice = $("#adultPrice").val();
            tour.tour.adultPriceForSuite = $("#adultPriceForSuite").val();
            tour.tour.adultPriceForDouble = $("#adultPriceForDouble").val();
            tour.tour.childPrice = $("#childPrice").val();
            tour.tour.infantPrice = $("#infantPrice").val();
            tour.includes = includes;
            tour.excludes = excludes;
            tour.expects = expects;
            tour.blockedDates = blockDates;
            // tour.packs = packs;
            tour.additionalInformations = additionalInformations;
            tour.days = selectedDays;
            tour.languages = selectedLanguages;
            tour.activities = selectedActivities;
            $.ajax({
                url: "/Tour/Add",
                type: "POST",
                contentType: "application/json",
                data: JSON.stringify(tour),
                success: function (data) {
                    if (data.status == true) {
                        Swal.fire({
                            title: data.title,
                            text: data.message,
                            icon: "success",
                            timer: 1500
                        });
                        setTimeout(function () {
                            location.href = document.referrer;
                        }, 1500);
                    } else {
                        Swal.fire({
                            title: data.title,
                            text: data.message,
                            icon: "error",
                            timer: 1500
                        });
                    }
                }
            });
        });
        $("#addIncludeBtn").click(function () {
            $("#addInclude").append("<div style='position: relative; '> <i onclick='remove(event)' class='fa fa-trash' style='position: absolute; right: -15px; top: 15px; '></i>  <textarea  class='form-control' style='margin:5px 0px'></textarea></div>");
        });
        $("#addExcludeBtn").click(function () {
            $("#addExclude").append("<div style='position: relative; '> <i onclick='remove(event)' class='fa fa-trash' style='position: absolute; right: -15px; top: 15px; '></i>  <textarea class='form-control' style='margin:5px 0px'></textarea></div>");
        });
        $("#addExpectBtn").click(function () {
            dayCount++;
            $("#addExpect").append(" <div style='position: relative; '> <i onclick='remove(event)' class='fa fa-trash' style='position: absolute; right: -15px; top: 15px; '></i> <textarea id='" + dayCount + "'  class='form-control' style='margin:5px 0px'></textarea></div>");
        });
        // $("#addPackBtn").click(function () {
        //     // $("#addPack").append(" <input type='text'  class='form-control' style='margin:5px 0px'/>");
        //     $("#addPack").append(" <div style='position: relative; '> <i onclick='remove(event)' class='fa fa-trash' style='position: absolute; right: -15px; top: 15px; '></i> <textarea class='form-control' style='margin: 5px 0px'></textarea></div>");
        // });
        $("#addadditionalInformationBtn").click(function () {
            $("#addadditionalInformation").append(" <div style='position: relative; '> <i onclick='remove(event)' class='fa fa-trash' style='position: absolute; right: -15px; top: 15px; '></i> <textarea class='form-control' style='margin: 5px 0px'></textarea></div>");
        });
    });
    function remove(e){
        $(event.target).parent().remove();
    }
    function edittour(id,name) {
        $(".modal-body #tourId").val(id);
        $(".modal-body #title").val(name);
        }
</script>